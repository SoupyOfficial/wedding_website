#!/bin/sh

# Pre-push hook: catches migration drift before it reaches CI
# Install: cp scripts/git-hooks/pre-push .git/hooks/pre-push && chmod +x .git/hooks/pre-push
# Or run: npm run hooks:install

echo ""
echo "üîí Pre-push checks..."
echo ""

# 1. Migration drift check
echo "‚Üí Checking Prisma migration integrity..."
npx tsx scripts/check-migrations.ts
if [ $? -ne 0 ]; then
  echo ""
  echo "‚ùå Push blocked: fix migration drift before pushing."
  echo ""
  exit 1
fi

# 2. Lint check
echo "‚Üí Running lint..."
npm run lint --silent
if [ $? -ne 0 ]; then
  echo ""
  echo "‚ùå Push blocked: fix lint errors before pushing."
  echo ""
  exit 1
fi

# 3. Type check
echo "‚Üí Running type check..."
npx tsc --noEmit
if [ $? -ne 0 ]; then
  echo ""
  echo "‚ùå Push blocked: fix type errors before pushing."
  echo ""
  exit 1
fi

echo ""
echo "‚úÖ All pre-push checks passed!"
echo ""
